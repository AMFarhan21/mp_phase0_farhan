<!DOCTYPE html>
<html>

<head>
    <title>Authentication</title>
    <!-- Tailwind -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>

<body class="font-mono w-screen h-screen">

    <main
        class="text-white w-full h-full flex flex-col justify-center items-center bg-[url(./images/valorantWallpaper2.jpg)] bg-center bg-cover relative z-1">
        <form onsubmit="login(event)" id="form"
            class="z-10 mx-auto justify-between items-center max-w-[600px] w-full bg-white text-black p-4 rounded-xl space-y-4">
            <h1 class="font-bold text-4xl text-center">Login</h1>
            <div id="input_container" class="space-y-4">
                <input id="email" type="text" placeholder="Enter your email"
                    class="border-b-1 focus:outline-none px-4 py-1 w-full" required />
                <input id="password" type="password" placeholder="Enter your password"
                    class="border-b-1 focus:outline-none px-4 py-1 w-full" required />
            </div>
            <button type="submit"
                class="bg-red-600 px-6 py-2 rounded-lg text-white w-full cursor-pointer">Login</button>
        </form>
        <p class="text-white z-1">
            Dont have an account? <a href="./register.html" class="text-blue-500">Register here</a>
        </p>
        <div class="absolute inset-0 bg-black/60 z-0"></div>
    </main>


    <script>

        async function login(e) {
            e.preventDefault()

            const input_container = document.getElementById("input_container")
            const email = document.getElementById("email").value
            const password = document.getElementById("password").value


            try {
                const response = await fetch("http://localhost:3000/login", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ email, password })
                })

                const res = await response.json()


                if (res.success) {
                    alert(`Successfully log in, welcome ${res.result.username}`)
                    sessionStorage.setItem(`session`, true)
                    window.location.replace("./home.html")
                }

                if (!res.success) {
                    const oldError = document.getElementById('error-msg')
                    if (oldError) oldError.remove()

                    const errorMsg = document.createElement("span")
                    errorMsg.id = 'error-msg'
                    errorMsg.innerHTML = res.message
                    errorMsg.className = 'text-red-600 flex justify-center'
                    input_container.appendChild(errorMsg)
                }



            } catch (error) {
                console.error("ERROR on login function: ", error);
                throw error;
            }
        }

    </script>
</body>

</html>